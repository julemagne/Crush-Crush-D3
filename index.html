<!DOCTYPE html>
<html>
  <head>
  <title>Crush Crush D3</title>
  <!-- Load D3 from site -->
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <!-- CSS (Styling) -->
  <style type="text/css">

    body {
      margin: 0;
      font-family: sans-serif;
      font-size: 11px;
      fill: purple;
    }

    .axis path, .axis line {
      fill: none;
      stroke: maroon;
      shape-rendering: crispEdges;  /* Round any decimal pixels so it'll render nicely */
    }

    circle {
      fill: pink;
    }

    circle:hover{
      fill: magenta;
    }

  </style>
</head>

<body>
  <!-- Begin Javascript -->
  <script type="text/javascript">
    var w = window.innerWidth,
        h = window.innerHeight,
        margin = { top: 40, right: 150, bottom: 20, left: 40 },
        radius = 6;

    var svg = d3.select("body").append("svg").attr({
      width: w,
      height: h
    });

    d3.csv("targets.csv", function(dataset) {
      dataset.forEach(function(d) {
        d.x = +d.x;
        d["y"] = +d["y"];
        d.name = d.Target;
      });
    console.log(dataset[0]);
    // We're passing in a function in d3.max to tell it what we're maxing (x value)
    var xScale = d3.scale.linear()
        .domain([0, d3.max(dataset, function (d) { return d.x + 10; })])
        .range([margin.left, w - margin.right]);  // Set margins for x specific

    // We're passing in a function in d3.max to tell it what we're maxing (y value)
    var yScale = d3.scale.linear()
        .domain([0, d3.max(dataset, function (d) { return d.y + 10; })])
        .range([margin.top, h - margin.bottom]);  // Set margins for y specific

    // Add a X and Y Axis (Note: orient means the direction that ticks go, not position)
    var xAxis = d3.svg.axis().scale(xScale).orient("top");
    var yAxis = d3.svg.axis().scale(yScale).orient("left");

    // Sets circles attributes
    var circleAttrs = {
        cx: function(d) { return xScale(d.x); },
        cy: function(d) { return yScale(d.y); },
        r: radius
    };

    // Adds X-Axis as a 'g' element
    var xAxisGroup = svg.append("g").attr({
      "class": "axis",  // Give class so we can style it
      transform: "translate(" + [0, margin.top] + ")"  // Translate just moves it down into position (or will be on top)
    }).call(xAxis);  // Call the xAxis function on the group

    // Adds Y-Axis as a 'g' element
    var yAxisGroup = svg.append("g").attr({
      "class": "axis",
      transform: "translate(" + [margin.left, 0] + ")"
    }).call(yAxis);  // Call the yAxis function on the group

    var circles = svg.selectAll("circle")
        .data(dataset)
        .enter()
        .append("circle")
        .on("mouseover", handleMouseOver)
        .on("mouseout", handleMouseOut);

    circles.attr(circleAttrs);

    // Create Event Handlers for mouse
    function handleMouseOver(d, i) {  // Add interactivity

          // Use D3 to select element, change color and size
          d3.select(this).attr({
            // fill: "orange",
            r: radius * 2
          });

          // Specify where to put label of text
          svg.append("text").attr({
             id: "t" + d.x + "-" + d.y + "-" + i,  // Create an id for text so we can select it later for removing on mouseout
              x: function() { return xScale(d.x) + 19; },
              y: function() { return yScale(d.y) - 15; }
          })
          .text(function() {
            // Find all text for overlapping coordinates
            var allText = '';
            for (i = 0; i < dataset.length; i++) {
              if ((dataset[i].x == d.x) && (dataset[i].y == d.y)) {
                allText += dataset[i].name + ' ';
              }
            }
            allText += '(' + d.x + ',' + d.y + ')';
            return [allText];  // Value of the text
          });
        }

    function handleMouseOut(d, i) {
          // Use D3 to select element, change size back to normal
          d3.select(this).attr({
            r: radius
          });

          // Select text by id and then remove
          d3.select("#t" + d.x + "-" + d.y + "-" + i).remove();  // Remove text location
        }
      });

  </script>
</html>
